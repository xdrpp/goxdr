<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#375EAB">

  <title>analysistest - Go Documentation Server</title>

<link type="text/css" rel="stylesheet" href="../../../../../../../../../../../../../lib/godoc/style.css">

<script>window.initFuncs = [];</script>
<script src="../../../../../../../../../../../../../lib/godoc/jquery.js" defer></script>



<script>var goVersion = "go1.24.1";</script>
<script src="../../../../../../../../../../../../../lib/godoc/godocs.js" defer></script>
</head>
<body>

<div id='lowframe' style="position: fixed; bottom: 0; left: 0; height: 0; width: 100%; border-top: thin solid grey; background-color: white; overflow: auto;">
...
</div><!-- #lowframe -->

<div id="topbar" class="wide"><div class="container">
<div class="top-heading" id="heading-wide"><a href="../../../../../../../../../../../../index.html">Go Documentation Server</a></div>
<div class="top-heading" id="heading-narrow"><a href="../../../../../../../../../../../../index.html">GoDoc</a></div>
<a href="index.html#" id="menu-button"><span id="menu-button-arrow">&#9661;</span></a>
<form method="GET" action="http://localhost:6666/search">
<div id="menu">

<span class="search-box"><input type="search" id="search" name="q" placeholder="Search" aria-label="Search" required><button type="submit"><span><!-- magnifying glass: --><svg width="24" height="24" viewBox="0 0 24 24"><title>submit search</title><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/><path d="M0 0h24v24H0z" fill="none"/></svg></span></button></span>
</div>
</form>

</div></div>



<div id="page" class="wide">
<div class="container">


  <h1>
    Package analysistest
    <span class="text-muted"></span>
  </h1>







<div id="nav"></div>


<!--
	Copyright 2009 The Go Authors. All rights reserved.
	Use of this source code is governed by a BSD-style
	license that can be found in the LICENSE file.
-->
<!--
	Note: Static (i.e., not template-generated) href and id
	attributes start with "pkg-" to make it impossible for
	them to conflict with generated attributes (some of which
	correspond to Go identifiers).
-->

	<script>
	document.ANALYSIS_DATA = null;
	document.CALLGRAPH = null;
	</script>

	
		
		<div id="short-nav">
			<dl>
			<dd><code>import "github.com/xdrpp/goxdr/goroot/pkg/mod/golang.org/x/tools@v0.31.0/go/analysis/analysistest"</code></dd>
			</dl>
			<dl>
			<dd><a href="index.html#pkg-overview" class="overviewLink">Overview</a></dd>
			<dd><a href="index.html#pkg-index" class="indexLink">Index</a></dd>
			
			
			</dl>
		</div>
		<!-- The package's Name is printed as title by the top-level template -->
		<div id="pkg-overview" class="toggleVisible">
			<div class="collapsed">
				<h2 class="toggleButton" title="Click to show Overview section">Overview ▹</h2>
			</div>
			<div class="expanded">
				<h2 class="toggleButton" title="Click to hide Overview section">Overview ▾</h2>
				<p>Package analysistest provides utilities for testing analyzers.

				
			</div>
		</div>

		<div id="pkg-index" class="toggleVisible">
		<div class="collapsed">
			<h2 class="toggleButton" title="Click to show Index section">Index ▹</h2>
		</div>
		<div class="expanded">
			<h2 class="toggleButton" title="Click to hide Index section">Index ▾</h2>

		<!-- Table of contents for API; must be named manual-nav to turn off auto nav. -->
			<div id="manual-nav">
			<dl>
			
			
				<dd><a href="index.html#pkg-variables">Variables</a></dd>
			
			
				
				<dd><a href="index.html#WriteFiles">func WriteFiles(filemap map[string]string) (dir string, cleanup func(), err error)</a></dd>
			
			
				
				<dd><a href="index.html#Result">type Result</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#Run">func Run(t Testing, dir string, a *analysis.Analyzer, patterns ...string) []*Result</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#RunWithSuggestedFixes">func RunWithSuggestedFixes(t Testing, dir string, a *analysis.Analyzer, patterns ...string) []*Result</a></dd>
				
				
			
				
				<dd><a href="index.html#Testing">type Testing</a></dd>
				
				
			
			
			</dl>
			</div><!-- #manual-nav -->

		

		
			<h3>Package files</h3>
			<p>
			<span style="font-size:90%">
			
				<a href="http://localhost:6666/src/github.com/xdrpp/goxdr/goroot/pkg/mod/golang.org/x/tools@v0.31.0/go/analysis/analysistest/analysistest.go">analysistest.go</a>
			
			</span>
			</p>
		
		</div><!-- .expanded -->
		</div><!-- #pkg-index -->

		

		
		
			<h2 id="pkg-variables">Variables</h2>
			
				<p>TestData returns the effective filename of
the program&apos;s &quot;testdata&quot; directory.
This function may be overridden by projects using
an alternative build system (such as Blaze) that
does not run a test in its package directory.

				<pre>var <span id="TestData">TestData</span> = func() <a href="http://localhost:6666/pkg/builtin/#string">string</a> {
    testdata, err := <a href="http://localhost:6666/pkg/path/filepath/">filepath</a>.<a href="http://localhost:6666/pkg/path/filepath/#Abs">Abs</a>(&#34;testdata&#34;)
    if err != <a href="http://localhost:6666/pkg/builtin/#nil">nil</a> {
        <a href="http://localhost:6666/pkg/log/">log</a>.<a href="http://localhost:6666/pkg/log/#Fatal">Fatal</a>(err)
    }
    return testdata
}</pre>
			
		
		
			
			
			<h2 id="WriteFiles">func <a href="http://localhost:6666/src/github.com/xdrpp/goxdr/goroot/pkg/mod/golang.org/x/tools@v0.31.0/go/analysis/analysistest/analysistest.go?s=1201:1283#L36">WriteFiles</a>
				<a class="permalink" href="index.html#WriteFiles">&#xb6;</a>
				
				
			</h2>
			<pre>func WriteFiles(filemap map[<a href="http://localhost:6666/pkg/builtin/#string">string</a>]<a href="http://localhost:6666/pkg/builtin/#string">string</a>) (dir <a href="http://localhost:6666/pkg/builtin/#string">string</a>, cleanup func(), err <a href="http://localhost:6666/pkg/builtin/#error">error</a>)</pre>
			<p>WriteFiles is a helper function that creates a temporary directory
and populates it with a GOPATH-style project using filemap (which
maps file names to contents). On success it returns the name of the
directory and a cleanup function to delete it.
<p>TODO(adonovan): provide a newer version that accepts a testing.T,
calls T.TempDir, and calls T.Fatal on any error, avoiding the need
to return cleanup or err:
<pre>func WriteFilesToTmp(t *testing.T filemap map[string]string) string
</pre>

			
			

		
		
			
			
			<h2 id="Result">type <a href="http://localhost:6666/src/github.com/xdrpp/goxdr/goroot/pkg/mod/golang.org/x/tools@v0.31.0/go/analysis/analysistest/analysistest.go?s=15587:15923#L438">Result</a>
				<a class="permalink" href="index.html#Result">&#xb6;</a>
				
				
			</h2>
			<p>A Result holds the result of applying an analyzer to a package.
<p>Facts contains only facts associated with the package and its objects.
<p>This internal type was inadvertently and regrettably exposed
through a public type alias. It is essentially redundant with
<a href="http://localhost:6666/golang.org/x/tools/go/analysis/checker#Action">checker.Action</a>, but must be retained for compatibility. Clients may
access the public fields of the Pass but must not invoke any of
its &quot;verbs&quot;, since the pass is already complete.

			<pre>type Result struct {
<span id="Result.Action"></span>    Action *<a href="http://localhost:6666/pkg/golang.org/x/tools/go/analysis/checker/">checker</a>.<a href="http://localhost:6666/pkg/golang.org/x/tools/go/analysis/checker/#Action">Action</a>

    <span class="comment">// legacy fields</span>
<span id="Result.Facts"></span>    Facts       map[<a href="http://localhost:6666/pkg/go/types/">types</a>.<a href="http://localhost:6666/pkg/go/types/#Object">Object</a>][]<a href="http://localhost:6666/pkg/golang.org/x/tools/go/analysis/">analysis</a>.<a href="http://localhost:6666/pkg/golang.org/x/tools/go/analysis/#Fact">Fact</a> <span class="comment">// nil key =&gt; package fact</span>
<span id="Result.Pass"></span>    Pass        *<a href="http://localhost:6666/pkg/golang.org/x/tools/go/analysis/">analysis</a>.<a href="http://localhost:6666/pkg/golang.org/x/tools/go/analysis/#Pass">Pass</a>
<span id="Result.Diagnostics"></span>    Diagnostics []<a href="http://localhost:6666/pkg/golang.org/x/tools/go/analysis/">analysis</a>.<a href="http://localhost:6666/pkg/golang.org/x/tools/go/analysis/#Diagnostic">Diagnostic</a> <span class="comment">// see Action.Diagnostics</span>
<span id="Result.Result"></span>    Result      <a href="http://localhost:6666/pkg/builtin/#any">any</a>                   <span class="comment">// see Action.Result</span>
<span id="Result.Err"></span>    Err         <a href="http://localhost:6666/pkg/builtin/#error">error</a>                 <span class="comment">// see Action.Err</span>
}
</pre>

			

			

			
			
			

			
				
				<h3 id="Run">func <a href="http://localhost:6666/src/github.com/xdrpp/goxdr/goroot/pkg/mod/golang.org/x/tools@v0.31.0/go/analysis/analysistest/analysistest.go?s=13520:13603#L367">Run</a>
					<a class="permalink" href="index.html#Run">&#xb6;</a>
					
					
				</h3>
				<pre>func Run(t <a href="index.html#Testing">Testing</a>, dir <a href="http://localhost:6666/pkg/builtin/#string">string</a>, a *<a href="http://localhost:6666/pkg/golang.org/x/tools/go/analysis/">analysis</a>.<a href="http://localhost:6666/pkg/golang.org/x/tools/go/analysis/#Analyzer">Analyzer</a>, patterns ...<a href="http://localhost:6666/pkg/builtin/#string">string</a>) []*<a href="index.html#Result">Result</a></pre>
				<p>Run applies an analysis to the packages denoted by the &quot;go list&quot; patterns.
<p>It loads the packages from the specified
directory using golang.org/x/tools/go/packages, runs the analysis on
them, and checks that each analysis emits the expected diagnostics
and facts specified by the contents of &apos;// want ...&apos; comments in the
package&apos;s source files. It treats a comment of the form
&quot;//...// want...&quot; or &quot;/*...// want... */&quot; as if it starts at &apos;want&apos;.
<p>If the directory contains a go.mod file, Run treats it as the root of the
Go module in which to work. Otherwise, Run treats it as the root of a
GOPATH-style tree, with package contained in the src subdirectory.
<p>An expectation of a Diagnostic is specified by a string literal
containing a regular expression that must match the diagnostic
message. For example:
<pre>fmt.Printf(&quot;%s&quot;, 1) // want `cannot provide int 1 to %s`
</pre>
<p>An expectation of a Fact associated with an object is specified by
&apos;name:&quot;pattern&quot;&apos;, where name is the name of the object, which must be
declared on the same line as the comment, and pattern is a regular
expression that must match the string representation of the fact,
fmt.Sprint(fact). For example:
<pre>func panicf(format string, args interface{}) { // want panicf:&quot;printfWrapper&quot;
</pre>
<p>Package facts are specified by the name &quot;package&quot; and appear on
line 1 of the first source file of the package.
<p>A single &apos;want&apos; comment may contain a mixture of diagnostic and fact
expectations, including multiple facts about the same object:
<pre>// want &quot;diag&quot; &quot;diag2&quot; x:&quot;fact1&quot; x:&quot;fact2&quot; y:&quot;fact3&quot;
</pre>
<p>Unexpected diagnostics and facts, and unmatched expectations, are
reported as errors to the Testing.
<p>Run reports an error to the Testing if loading or analysis failed.
Run also returns a Result for each package for which analysis was
attempted, even if unsuccessful. It is safe for a test to ignore all
the results, but a test may use it to perform additional checks.

				
				
			
				
				<h3 id="RunWithSuggestedFixes">func <a href="http://localhost:6666/src/github.com/xdrpp/goxdr/goroot/pkg/mod/golang.org/x/tools@v0.31.0/go/analysis/analysistest/analysistest.go?s=4490:4591#L133">RunWithSuggestedFixes</a>
					<a class="permalink" href="index.html#RunWithSuggestedFixes">&#xb6;</a>
					
					
				</h3>
				<pre>func RunWithSuggestedFixes(t <a href="index.html#Testing">Testing</a>, dir <a href="http://localhost:6666/pkg/builtin/#string">string</a>, a *<a href="http://localhost:6666/pkg/golang.org/x/tools/go/analysis/">analysis</a>.<a href="http://localhost:6666/pkg/golang.org/x/tools/go/analysis/#Analyzer">Analyzer</a>, patterns ...<a href="http://localhost:6666/pkg/builtin/#string">string</a>) []*<a href="index.html#Result">Result</a></pre>
				<p>RunWithSuggestedFixes behaves like Run, but additionally applies
suggested fixes and verifies their output.
<p>It uses golden files, placed alongside each source file, to express
the desired output: the expected transformation of file example.go
is specified in file example.go.golden.
<p>Golden files may be of two forms: a plain Go source file, or a
txtar archive.
<p>A plain Go source file indicates the expected result of applying
all suggested fixes to the original file.
<p>A txtar archive specifies, in each section, the expected result of
applying all suggested fixes of a given message to the original
file; the name of the archive section is the fix&apos;s message. In this
way, the various alternative fixes offered by a single diagnostic
can be tested independently. Here&apos;s an example:
<pre>-- turn into single negation --
package pkg

func fn(b1, b2 bool) {
	if !b1 { // want `negating a boolean twice`
		println()
	}
}

-- remove double negation --
package pkg

func fn(b1, b2 bool) {
	if b1 { // want `negating a boolean twice`
		println()
	}
}
</pre>
<h3 id="hdr-Conflicts">Conflicts</h3>
<p>Regardless of the form of the golden file, it is possible for
multiple fixes to conflict, either because they overlap, or are
close enough together that the particular diff algorithm cannot
separate them.
<p>RunWithSuggestedFixes uses a simple three-way merge to accumulate
fixes, similar to a git merge. The merge algorithm may be able to
coalesce identical edits, for example duplicate imports of the same
package. (Bear in mind that this is an editorial decision. In
general, coalescing identical edits may not be correct: consider
two statements that increment the same counter.)
<p>If there are conflicts, the test fails. In any case, the
non-conflicting edits will be compared against the expected output.
In this situation, we recommend that you increase the textual
separation between conflicting parts or, if that fails, split
your tests into smaller parts.
<p>If a diagnostic offers multiple fixes for the same problem, they
are almost certain to conflict, so in this case you should define
the expected output using a multi-section txtar file as described
above.

				
				
			

			
		
			
			
			<h2 id="Testing">type <a href="http://localhost:6666/src/github.com/xdrpp/goxdr/goroot/pkg/mod/golang.org/x/tools@v0.31.0/go/analysis/analysistest/analysistest.go?s=2131:2193#L68">Testing</a>
				<a class="permalink" href="index.html#Testing">&#xb6;</a>
				
				
			</h2>
			<p>Testing is an abstraction of a *testing.T.

			<pre>type Testing interface {
    Errorf(format <a href="http://localhost:6666/pkg/builtin/#string">string</a>, args ...<a href="http://localhost:6666/pkg/builtin/#any">any</a>)
}</pre>

			

			

			
			
			

			

			
		
	

	







<div id="footer">
Build version go1.24.1.<br>
Except as <a href="https://developers.google.com/site-policies#restrictions">noted</a>,
the content of this page is licensed under the
Creative Commons Attribution 3.0 License,
and code is licensed under a <a href="http://localhost:6666/LICENSE">BSD license</a>.<br>
<a href="https://golang.org/doc/tos.html">Terms of Service</a> |
<a href="https://www.google.com/intl/en/policies/privacy/">Privacy Policy</a>
</div>

</div><!-- .container -->
</div><!-- #page -->
</body>
</html>
